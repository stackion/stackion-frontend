<!DOCTYPE html>
<html dir="ltr" lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="keywords" content="stackion, crypto investment"/>
        <meta name="description" content="Stackion, The largest crypto stock trading and investment platform."/>
        <title>Stackion - Register to get started</title>
        <noscript>
            <meta http-equiv="refresh" content="20; ../noscript/index.html"/>
        </noscript>
        <link rel="stylesheet" href="../styles/css/all.css"/>
        <link rel="stylesheet" href="../styles/animate.css">
        <link rel="icon" href="../images/favicon.png" sizes="16x16"/>
        <link rel="stylesheet" href="../styles/main.css"/>
        <script type="text/javascript" src="../scripts/jquery.js"></script>
        <script type="text/javascript" src="../scripts/main.js"></script>
    </head>
    <body>
        <div class="body">
            <div class="header flex-box">
                <div class="header-content">
                    <img src="../images/logo.png" id="logo"/>
                </div>
            </div>
            <div class="form-and-form-nav-cont">
                <div class="form-nav flex-box">
                    <a href="javascript:void(0);" class="text-default-blue-color bg-light-grey mini-size centered-text" title="Register to get started">
                        Register
                    </a>
                    <a href="../login/" class="text-grey-variant-2-color mini-size centered-text" title="Login to your account">
                        Login
                    </a>
                </div>
                <div class="form-cont">
                    <form action="../app" method="POST" enctype="application/x-www-form-urlencoded" name="registration-form">
                        <input type="email" id="email" class="input-section text-grey-variant-2-color" name="email" placeholder="Email address" required/>
                        <br/>
                        <input type="password" id="password" class="input-section text-grey-variant-2-color" name="password" placeholder="Password" required/>
                        <br/>
                        <ul class="validation-list-text text-grey-variant-2-color">
                            <li id="password-length">
                                Password must contain at least 8 characters.
                            </li>
                            <li id="password-special-characters">
                                Password must contain alphabets, numbers and characters like @ or  # or $ or %.
                            </li>
                            <li id="password-match">
                                Passwords must be the same.
                            </li>
                        </ul>
                        <input type="password" id="retyped-password" placeholder="Retype password" class="input-section text-grey-variant-2-color">
                        <br/>
                        <br/>
                        <p class="text-grey-variant-2-color">
                            By clicking continue we assume that you have read and that you agree with our <a href="#terms and policies" class="text-default-blue-color" title="Our terms and policies">terms and policies</a>.
                        </p>
                        <br/>
                        <label for="understands-policies" class="text-grey-variant-2-color">
                            I understand.
                        </label>
                        <input type="checkbox" id="understands-policies" class="input-type-check-box" checked>
                        <br/>
                        <input type="submit" class="input-section default-blue-bg text-white-color" value="Continue" disabled>
                    </form>
                </div>
            </div>
        </div>
        <!--loader template-->
        <div class="loader-box-cont">
            <div class="loader-box">
                <div class="loader-content-cont">
                    <img id="logo-in-loader" src="../images/favicon.png"/>
                    <div class="loader-balls-cont flex-box">
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                        <div class="loader-ball"></div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $("*").ready(
                () => {
                    const arrayOfInputFields = Array.from($("input"));
                    const passwordInput = $("#password");
                    const passwordConfirmation = $("#retyped-password");
                    const aggrementWithtermsInput = $("#understands-policies");
                    const emailInput = $("#email");
                    const formSubmitionBtn = arrayOfInputFields[arrayOfInputFields.length -1];
                    const passwordLengthNotifyer = $("#password-length");
                    const passwordCharacterNotifyer = $("#password-special-characters");
                    const passwordsMatchNotifyer = $("#password-match");
                    
                    let passwordIsLongEnough = false , passwordsMatch = false , passwordContainsNumbers = false , passwordContainsAlpha = false , passwordContainsSpecialCharacters = false , emailIsEmpty = true;

                    arrayOfInputFields.forEach( e => e.addEventListener("input" , validateFormData) );

                    const numberValues = /[0-9]/;
                    const alphaValues = /[a-z]/i;
                    const characterValues = /[!@#$%&()]/;
                    
                    function validateFormData() {
                        passwordInput.val().trim().length >= 8 ? passwordIsLongEnough = true : passwordIsLongEnough = false;

                        passwordInput.val().trim() === passwordConfirmation.val().trim() && passwordInput.val().trim() !== "" ? passwordsMatch = true : passwordsMatch = false;
                        numberValues.test(passwordInput.val().trim()) ? passwordContainsNumbers = true : passwordContainsNumbers = false;
                        alphaValues.test(passwordInput.val().trim()) ? passwordContainsAlpha = true : passwordContainsAlpha = false;

                        characterValues.test(passwordInput.val().trim()) ? passwordContainsSpecialCharacters = true : passwordContainsSpecialCharacters = false;
                        emailInput.val().trim() === "" ? emailIsEmpty = true : emailIsEmpty = false;

                        if(passwordIsLongEnough) {
                            passwordLengthNotifyer.css("color","#00aa00");
                        } else {
                            passwordLengthNotifyer.css("color","#c44500");
                        }

                        if(passwordContainsNumbers && passwordContainsAlpha && passwordContainsSpecialCharacters) {
                            passwordCharacterNotifyer.css("color","#00aa00");
                        } else {
                            passwordCharacterNotifyer.css("color","#c44500");
                        }

                        if(passwordsMatch) {
                            passwordsMatchNotifyer.css("color","#00aa00");
                        } else {
                            passwordsMatchNotifyer.css("color","#c44500");
                        }
                        
                        if(!emailIsEmpty && passwordsMatch && passwordContainsNumbers && passwordContainsAlpha && passwordContainsSpecialCharacters && $only("input[type='checkbox']").checked === true ) {
                            formSubmitionBtn.disabled = false;
                        } else {
                            formSubmitionBtn.disabled = true;
                        }
                    }
                    formSubmitionBtn.addEventListener("click",
                        () => {
                            $(".loader-box-cont").css("display","flex");

                            //send form data
                            const xhttp = new XMLHttpRequest();

                            xhttp.onload = function() {
                                $(".loader-box-cont").css("display","none");
                                let response = this.responseText , pasred_response = JSON.parse(response);
                                if(localStorage) {
                                    localStorage.setItem("credentials",response);
                                    if(pasred_response.verified_email === 0) {
                                        location.assign("../verify");
                                    }
                                    else {
                                        location.assign("../dashboard");
                                    }
                                } else {
                                    alert("Process canceled!\nYour browser does not support local storage or it has been disabled. Enable all cookies and try again");
                                }
                            };
                            xhttp.open("POST","http://localhost:4000/",true);
                            xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                            xhttp.send(`email_address=${emailInput.val().trim()}&password=${passwordInput.val().trim()}&request_name=registration-form`);
                        }
                    );
                    if(!localStorage) {
                        alert("Process canceled!\nYour browser does not support local storage or it has been disabled. Enable all cookies and try again");
                    }
                   /* if(localStorage.getItem("credentials")) {
                        if(JSON.parse(localStorage.getItem("credentials")).verified_email === 0) {
                            location.assign("../verify");
                        }
                        else {
                            location.assign("../dashboard");
                        }
                    }*/
                }
            );
        </script>
    </body>
</html>